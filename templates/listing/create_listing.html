{% extends 'base.html' %}
{% load widget_tweaks %}

{% block content %}
    
{% if form.errors %}
<div class="alert alert-error mb-6">
  <div>
    <i class="fas fa-exclamation-circle"></i>
    <span>Formda hatalar bulunuyor:</span>
    <ul class="mt-2">
      {% for field, errors in form.errors.items %}
        {% for error in errors %}
          <li>- {{ field }}: {{ error }}</li>
        {% endfor %}
      {% endfor %}
    </ul>
  </div>
</div>
{% endif %}
<div class="max-w-4xl mx-auto my-8">
  <div class="bg-white rounded-xl shadow-lg overflow-hidden">
   
    <div class="bg-gradient-to-r from-primary to-indigo-600 text-white p-6">
      <h1 class="text-2xl font-bold flex items-center">
        <i class="fas fa-plus-circle mr-3"></i> Yeni İlan Oluştur
      </h1>
      <p class="text-sm opacity-90 mt-1">Kitap veya ders notlarınızı paylaşın</p>
    </div>

  
    <form method="post" enctype="multipart/form-data" class="p-6 space-y-6">
      {% csrf_token %}
      {{ form.non_field_errors }}
>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        <div class="form-control">
          <label class="label" for="{{ form.title.id_for_label }}">
            <span class="label-text">{{ form.title.label }}</span>
          </label>
          {{ form.title|add_class:"input input-bordered w-full focus:ring-2 focus:ring-primary" }}
          {% if form.title.errors %}
            <p class="text-red-500 text-sm mt-1">{{ form.title.errors|striptags }}</p>
          {% endif %}
        </div>

        <div class="form-control">
          <label class="label" for="{{ form.listing_type.id_for_label }}">
            <span class="label-text">{{ form.listing_type.label }}</span>
          </label>
          {{ form.listing_type|add_class:"select select-bordered w-full focus:ring-2 focus:ring-primary" }}
        </div>
      </div>

      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="dynamic-fields">
       
        <div class="form-control">
          <label class="label" for="{{ form.level.id_for_label }}">
            <span class="label-text">{{ form.level.label }}</span>
          </label>
          {{ form.level|add_class:"select select-bordered w-full" }}
        </div>

        
        <div class="form-control">
          <label class="label" for="{{ form.donation_type.id_for_label }}">
            <span class="label-text">{{ form.donation_type.label }}</span>
          </label>
          {{ form.donation_type|add_class:"select select-bordered w-full" }}
        </div>

      
        <div class="form-control hidden" id="price-field">
          <label class="label" for="{{ form.price.id_for_label }}">
            <span class="label-text">{{ form.price.label }}</span>
          </label>
          <div class="relative">
            {{ form.price|add_class:"input input-bordered w-full pl-8" }}
            <span class="absolute left-3 top-3 text-gray-500">₺</span>
          </div>
        </div>
      </div>

 
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 hidden" id="book-fields">
        <div class="form-control">
          <label class="label" for="{{ form.publish_year.id_for_label }}">
            <span class="label-text">{{ form.publish_year.label }}</span>
          </label>
          {{ form.publish_year|add_class:"input input-bordered w-full" }}
        </div>

        <div class="form-control">
          <label class="label" for="{{ form.publisher.id_for_label }}">
            <span class="label-text">{{ form.publisher.label }}</span>
          </label>
          {{ form.publisher|add_class:"input input-bordered w-full" }}
        </div>
      </div>

     
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 hidden" id="note-fields">
        <div class="form-control">
          <label class="label" for="{{ form.school_name.id_for_label }}">
            <span class="label-text">{{ form.school_name.label }}</span>
          </label>
          {{ form.school_name|add_class:"input input-bordered w-full" }}
        </div>

        <div class="form-control">
          <label class="label" for="{{ form.valid_year.id_for_label }}">
            <span class="label-text">{{ form.valid_year.label }}</span>
          </label>
          {{ form.valid_year|add_class:"input input-bordered w-full" }}
        </div>
      </div>

      
      <div class="grid grid-cols-1 gap-6">
        <div class="form-control">
          <label class="label" for="{{ form.related_course.id_for_label }}">
            <span class="label-text">{{ form.related_course.label }}</span>
          </label>
          {{ form.related_course|add_class:"input input-bordered w-full" }}
        </div>

     
        <div class="form-control">
          <label class="label" for="{{ form.page_count.id_for_label }}">
            <span class="label-text">{{ form.page_count.label }}</span>
          </label>
          {{ form.page_count|add_class:"input input-bordered w-full" }}
          {% if form.page_count.errors %}
            <p class="text-red-500 text-sm mt-1">{{ form.page_count.errors|striptags }}</p>
          {% endif %}
          <p class="text-sm text-gray-500 mt-1">Toplam sayfa sayısı</p>
        </div>

        <div class="form-control">
          <label class="label" for="{{ form.description.id_for_label }}">
            <span class="label-text">{{ form.description.label }}</span>
          </label>
          {{ form.description|add_class:"textarea textarea-bordered w-full h-32" }}
        </div>

        <div class="form-control">
          <label class="label" for="{{ form.image.id_for_label }}">
            <span class="label-text">{{ form.image.label }}</span>
          </label>
          <div class="file-input">
            {{ form.image|add_class:"file-input file-input-bordered w-full" }}
          </div>
          <p class="text-sm text-gray-500 mt-1">JPEG veya PNG formatında yükleyin</p>
        </div>
      </div>

    
      <div class="flex justify-end space-x-4 pt-6 border-t">
        <a href="{% url 'home' %}" class="btn btn-outline">İptal</a>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save mr-2"></i> İlanı Yayınla
        </button>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const listingType = document.getElementById('id_listing_type');
  const donationType = document.getElementById('id_donation_type');
  const priceField = document.getElementById('price-field');
  const bookFields = document.getElementById('book-fields');
  const noteFields = document.getElementById('note-fields');

  function updateFields() {
    
    if (donationType.value === 'paid') {
      priceField.classList.remove('hidden');
    } else {
      priceField.classList.add('hidden');
    }

    
    if (listingType.value === 'book') {
      bookFields.classList.remove('hidden');
      noteFields.classList.add('hidden');
    } else if (listingType.value === 'note') {
      bookFields.classList.add('hidden');
      noteFields.classList.remove('hidden');
    } else {
      bookFields.classList.add('hidden');
      noteFields.classList.add('hidden');
    }
  }

  
  listingType.addEventListener('change', updateFields);
  donationType.addEventListener('change', updateFields);

 
  updateFields();
});
</script>

<style>
.file-input::file-selector-button {
  @apply bg-gray-100 text-gray-700 border-r border-gray-300 px-4 py-2 mr-2;
}
.file-input:hover::file-selector-button {
  @apply bg-gray-200;
}
</style>
{% endblock %}