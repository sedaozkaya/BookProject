{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h2>İlan Oluştur</h2>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.non_field_errors }}

    {# Ürün adı (title) alanı #}
    <div class="mb-3" id="field-title">
      <label for="{{ form.title.id_for_label }}" class="form-label">{{ form.title.label }}</label>
      {{ form.title }}
      {% if form.title.errors %}
        <div class="text-danger">{{ form.title.errors|striptags }}</div>
      {% endif %}
    </div>

    {# Seviye (level) alanı #}
    <div class="mb-3" id="field-level">
      <label for="{{ form.level.id_for_label }}" class="form-label">{{ form.level.label }}</label>
      {{ form.level }}
      {% if form.level.errors %}
        <div class="text-danger">{{ form.level.errors|striptags }}</div>
      {% endif %}
    </div>

    {# Diğer alanlar döngü ile #}
    {% for field in form %}
      {% if field.name != 'title' and field.name != 'level' %}
      <div class="mb-3" id="field-{{ field.name }}">
        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
        {{ field }}
        {% if field.errors %}
          <div class="text-danger">{{ field.errors|striptags }}</div>
        {% endif %}
      </div>
      {% endif %}
    {% endfor %}

    <button type="submit" class="btn btn-primary">Kaydet</button>
  </form>
</div>

<script>
  function updateFieldVisibility() {
    const listingType = document.querySelector('#id_listing_type').value;
    const donationType = document.querySelector('#id_donation_type').value;

    const bookOnlyFields = ['publish_year', 'publisher', 'resolution_level'];
    bookOnlyFields.forEach(field => {
      const el = document.getElementById('field-' + field);
      if (el) {
        el.style.display = (listingType === 'book') ? 'block' : 'none';
      }
    });

    const noteOnlyFields = ['school_name', 'valid_year'];
    noteOnlyFields.forEach(field => {
      const el = document.getElementById('field-' + field);
      if (el) {
        el.style.display = (listingType === 'note') ? 'block' : 'none';
      }
    });

    const priceField = document.getElementById('field-price');
    if (priceField) {
      priceField.style.display = (donationType === 'paid') ? 'block' : 'none';
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    const listingTypeElement = document.querySelector('#id_listing_type');
    const donationTypeElement = document.querySelector('#id_donation_type');

    if(listingTypeElement) listingTypeElement.addEventListener('change', updateFieldVisibility);
    if(donationTypeElement) donationTypeElement.addEventListener('change', updateFieldVisibility);

    updateFieldVisibility();
  });
</script>
{% endblock %}
