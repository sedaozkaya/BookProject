{% extends 'advert/base.html' %}
{% block content %}
<div class="container mt-4">
  <h2>İlan Oluştur</h2>
  <form method="post">
    {% csrf_token %}
    {% for field in form %}
      <div class="mb-3" id="field-{{ field.name }}">
        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
        {{ field }}
        {% if field.errors %}
          <div class="text-danger">{{ field.errors|striptags }}</div>
        {% endif %}
      </div>
    {% endfor %}
    <button type="submit" class="btn btn-primary">Kaydet</button>
  </form>
</div>

<script>
  function updateFieldVisibility() {
    const listingType = document.querySelector('#id_listing_type').value;
    const donationType = document.querySelector('#id_donation_type').value;

    const bookOnlyFields = ['publish_year', 'publisher', 'resolution_level'];
    bookOnlyFields.forEach(field => {
      document.getElementById('field-' + field).style.display =
        (listingType === 'book') ? 'block' : 'none';
    });

    const noteOnlyFields = ['school_name', 'valid_year'];
    noteOnlyFields.forEach(field => {
      document.getElementById('field-' + field).style.display =
        (listingType === 'note') ? 'block' : 'none';
    });

    const priceField = document.getElementById('field-price');
    priceField.style.display = (donationType === 'paid') ? 'block' : 'none';
  }

  document.addEventListener('DOMContentLoaded', function () {
    document.querySelector('#id_listing_type').addEventListener('change', updateFieldVisibility);
    document.querySelector('#id_donation_type').addEventListener('change', updateFieldVisibility);
    updateFieldVisibility();
  });
</script>
{% endblock %}
